version: 2
jobs:
  build:
    docker:
     - image: circleci/php:7.4-cli
      
      working_dir: /usr/src/login-api-laravel
      links: 
        - mysql
        - mysql_test
      ports:
        - "8000:8000"
    steps: 
      - checkout 
      - run: echo "composer installing"
      - run: composer install
      - run: php artisan migrate:fresh
      - run: php artisan db:seed
      - run: php artisan serve
      - run: CI=true
      build:
  db:
    docker:
     - image: circleci/php:7.4-cli
      
      working_dir: /usr/src/login-api-laravel
      links: 
        - mysql
        - mysql_test
      ports:
        - "8000:8000"
    steps: 
      - checkout 
      - run: echo "composer installing"
      - run: composer install
      - run: php artisan migrate:fresh
      - run: php artisan db:seed
      - run: php artisan serve
      - run: CI=true
workflows: 
  version: 2
  build_app:
    jobs:
      - db
      - build
